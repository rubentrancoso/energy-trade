# v1.1.0-matching: Order Matching Engine

## üéØ Delivery Objective

Implement the core matching engine that handles automatic execution of orders by pairing BUY and SELL requests based on price and time priority.

## üìú Specifications Implemented

* A new component named `MatchingEngine` handles the logic of matching orders.
* The system supports:

  * Prioritization of matching based on **best price** and **earliest timestamp**.
  * **Partial executions**, allowing remaining volume to stay open.
  * Full execution detection and proper status transitions (`PENDING`, `PARTIAL`, `EXECUTED`).
* After an order is created, matching is triggered automatically by the controller.
* Every matched or partially matched transaction generates:

  * An **audit event** with the status and execution details.
  * A **notification** for administrative awareness.
* Order model now includes:

  * `executedVolume`: a cumulative sum of matched volume.
  * `getRemainingVolume()`: helper method for calculating the difference between total and executed volume.
* Matching operations respect isolation (e.g., no matching with already executed orders).

## üì¶ Feature Summary

* Introduced `MatchingEngine` component
* Modified `OrderController` to trigger matching after order creation
* Updated `Order` model with: `executedVolume`, `status`, `getRemainingVolume()`
* New audit events and notifications during the execution process

## üìÅ Main Files Modified

* `OrderController.java`
* `MatchingEngine.java`
* `Order.java`
* `application.properties` (references to pricing, audit, and notification services)

## üîÑ Execution Flow

1. An order is created via `/orders`
2. Market price is fetched from the `pricing-service`
3. The order is persisted to the database
4. The `MatchingEngine` is **invoked with this order**:

   * Retrieves eligible counterpart orders from the repository
   * Sorts by price and timestamp (FIFO priority)
   * Executes partial or full volume
   * Updates status of the order and its counterparts
5. Audit events and notifications are sent

## ‚úçÔ∏è Technical Details & Decisions

* Order comparison logic is handled directly in `MatchingEngine`, avoiding database-level logic.
* `OrderStatus` is stored as `@Enumerated(EnumType.STRING)` for clarity and to prevent serialization bugs.
* `@Transactional` was not added at this stage for simplicity but may be required later.
* Integration tests were dropped in this phase in favor of future unit or behavioral tests.

## üß™ Testing & Coverage

* Manually validated using REST calls
* Audit logs confirm matching behavior
* Integration tests temporarily disabled to avoid conflicts with external services

## ‚úÖ Delivery Checklist

* [x] Matching Engine logic implemented
* [x] Controller triggers matching
* [x] Model extended with execution tracking
* [x] Audit and Notification system integration
* [x] Manual validation confirmed

---

üìé Back to the [version history](../README.md#version-history)
